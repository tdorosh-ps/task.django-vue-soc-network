(function(t){function e(e){for(var s,a,i=e[0],u=e[1],c=e[2],p=0,d=[];p<i.length;p++)a=i[p],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&d.push(n[a][0]),n[a]=0;for(s in u)Object.prototype.hasOwnProperty.call(u,s)&&(t[s]=u[s]);l&&l(e);while(d.length)d.shift()();return o.push.apply(o,c||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],s=!0,i=1;i<r.length;i++){var u=r[i];0!==n[u]&&(s=!1)}s&&(o.splice(e--,1),t=a(a.s=r[0]))}return t}var s={},n={app:0},o=[];function a(e){if(s[e])return s[e].exports;var r=s[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=s,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(r,s,function(e){return t[e]}.bind(null,s));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var l=u;o.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"56d7":function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var s,n=r("2b0e"),o=r("2f62"),a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[r("navigationBar"),r("router-view")],1)},i=[],u=(r("d3b7"),r("99af"),r("4de4"),r("ade3")),c=r("2909"),l="AUTH_REQUEST",p="AUTH_SUCCESS",d="AUTH_ERROR",f="AUTH_LOGOUT",m="SET_USER",h="CREATE_USER",b="SET_POSTS",v="SET_POST",g="CREATE_POST",w="LIKE_POST",_=(s={},Object(u["a"])(s,l,(function(t){t.authStatus="loading",t.userEvent=""})),Object(u["a"])(s,p,(function(t,e){t.authStatus="success",t.accessToken=e.access,e.refresh&&(t.refreshToken=e.refresh)})),Object(u["a"])(s,d,(function(t){t.authStatus="error"})),Object(u["a"])(s,f,(function(t){t.authStatus="logout",t.accessToken=null,t.refreshToken=null})),Object(u["a"])(s,h,(function(t){t.userEvent="create"})),Object(u["a"])(s,m,(function(t,e){t.authUser=e})),Object(u["a"])(s,b,(function(t,e){t.posts=e})),Object(u["a"])(s,v,(function(t,e){t.post=e})),Object(u["a"])(s,g,(function(t,e){t.postEvent="create",t.post=[e].concat(Object(c["a"])(t.posts))})),Object(u["a"])(s,w,(function(t,e,r){"like"===r?t.post.users_liked=[e].concat(Object(c["a"])(t.post.users_liked)):"unlike"===r&&(t.post.users_liked=t.post.users_liked.filter((function(t){return t.id!=e.id})))})),s),k=(r("96cf"),r("1da1")),E=r("bc3a"),y=r.n(E),S=y.a.create({baseURL:"http://127.0.0.1:8000/api/v1/"}),x=S,O=x,P={authRequest:function(t,e){var r=t.commit;return new Promise((function(t,s){r(l),O.post("token/",e).then((function(e){var s=e.data;localStorage.setItem("user-token",s.access),localStorage.setItem("user-refresh-token",s.refresh),x.defaults.headers.common.Authorization="Bearer ".concat(s.access),r(p,s),t(e)})).catch((function(t){r(d),localStorage.removeItem("user-token"),localStorage.removeItem("user-refresh-token"),s(t)}))}))},refreshAuthRequest:function(t,e){var r=t.commit;return new Promise((function(t,s){r(l),O.post("token/refresh/",e).then((function(e){var s=e.data;localStorage.setItem("user-token",s.access),x.defaults.headers.common.Authorization="Bearer ".concat(s.access),r(p,s),t(e)})).catch((function(t){r(d),localStorage.removeItem("user-token"),localStorage.removeItem("user-refresh-token"),s(t)}))}))},authLogout:function(t){var e=t.commit;return new Promise((function(t){e(f),localStorage.removeItem("user-token"),localStorage.removeItem("user-refresh-token"),delete x.defaults.headers.common.Authorization,t()}))},createUser:function(t,e){var r=t.commit;return new Promise((function(t,s){O.post("accounts/create/",e).then((function(e){r(h),t(e)})).catch((function(t){s(t)}))}))},getUser:function(t){return Object(k["a"])(regeneratorRuntime.mark((function e(){var r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.commit,e.next=3,O.get("accounts/");case 3:s=e.sent,200===s.status&&r(m,s.data);case 5:case"end":return e.stop()}}),e)})))()},getPosts:function(t,e){return Object(k["a"])(regeneratorRuntime.mark((function r(){var s,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s=t.commit,r.next=3,O.get("posts/",e);case 3:n=r.sent,200===n.status&&s(b,n.data);case 5:case"end":return r.stop()}}),r)})))()},getPost:function(t,e){return Object(k["a"])(regeneratorRuntime.mark((function r(){var s,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s=t.commit,r.next=3,O.get("post/".concat(e,"/"));case 3:n=r.sent,200===n.status&&s(v,n.data);case 5:case"end":return r.stop()}}),r)})))()},createPost:function(t,e){return Object(k["a"])(regeneratorRuntime.mark((function r(){var s,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s=t.commit,r.next=3,O.post("post/create/",e);case 3:n=r.sent,201===n.status&&s(g,n.data);case 5:case"end":return r.stop()}}),r)})))()},likePost:function(t,e){return Object(k["a"])(regeneratorRuntime.mark((function r(){var s,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s=t.commit,r.next=3,O.post("post/".concat(e.post.id,"/like/"),e.data);case 3:n=r.sent,202===n.status&&s(w,e.post.owner,e.data.action);case 5:case"end":return r.stop()}}),r)})))()}},j=P;n["default"].use(o["a"]);var $=new o["a"].Store({state:{authUser:null,accessToken:localStorage.getItem("user-token")||"",refreshToken:localStorage.getItem("user-refresh-token")||"",authStatus:"wait",userEvent:"",postEvent:"",posts:[],post:null},getters:{authUser:function(t){return t.authUser},isAuthenticated:function(t){return!!t.accessToken},authStatus:function(t){return t.authStatus},userEvent:function(t){return t.userEvent},posts:function(t){return t.posts},post:function(t){return t.post},postEvent:function(t){return t.postEvent}},mutations:Object.assign(_),actions:Object.assign(j)}),U=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"info"}},[r("b-navbar-brand",[t._v("Posts App")]),r("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),t.isAuthenticated?r("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[r("b-navbar-nav",[r("b-nav-item",{attrs:{to:{name:"all-posts"}}},[t._v("All Posts")]),r("b-nav-item",{attrs:{to:{name:"own-posts"}}},[t._v("Own Posts")])],1),r("b-navbar-nav",{staticClass:"ml-auto"},[r("b-nav-item",[t._v("Hello, user")]),r("b-nav-item",{attrs:{id:"logout"},on:{click:t.logout}},[t._v("Logout")])],1)],1):t._e()],1)],1)},T=[],C={name:"navigationBar",computed:{isAuthenticated:function(){return this.$store.getters.isAuthenticated}},methods:{logout:function(){var t=this;this.$store.dispatch("authLogout").then((function(){t.$router.push("/signin")}))}}},A=C,R=r("2877"),L=Object(R["a"])(A,U,T,!1,null,null,null),I=L.exports,q={name:"app",components:{navigationBar:I},created:function(){x.interceptors.response.use(void 0,(function(t){var e=this,r=t.config;if(401===t.response.status&&!r._retry&&$.state.refreshToken){r._retry=!0;var s={refresh:$.state.refreshToken};$.dispatch("refreshAuthRequest",s).then((function(){return r.headers["Authorization"]="Bearer ".concat($.state.accessToken),x(r)})).catch((function(){$.dispatch("authLogout").then((function(){e.$router.push("/signin")}))}))}return Promise.reject(t)}))}},B=q,M=Object(R["a"])(B,a,i,!1,null,null,null),H=M.exports,z=r("8c4f"),D=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container text-center bv-example-row bv-example-row-flex-cols"},[r("b-row",{staticClass:"mt-5",attrs:{"align-h":"center"}},[r("b-alert",{attrs:{variant:"success",show:t.isUserCreated,dismissible:""}},[t._v(" New user was created successfully. Now you can sign in with your email and password. ")])],1),r("b-row",{staticClass:"mt-5",attrs:{"align-h":"center"}},[r("b-form",{on:{submit:function(e){return e.preventDefault(),t.signIn(e)}}},[r("h3",[t._v("SignIn")]),r("b-alert",{attrs:{show:t.isError,variant:"warning",dismissible:""}},[t._v("Authentication error")]),r("b-form-group",{staticClass:"text-left",attrs:{label:"Email","label-for":"email"}},[r("b-form-input",{attrs:{id:"email",type:"text",required:""},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}})],1),r("b-form-group",{staticClass:"text-left",attrs:{label:"Password","label-for":"password"}},[r("b-form-input",{attrs:{id:"password",type:"password",required:""},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1),r("p",[t._v("Do not have an account? "),r("b-link",{attrs:{to:{name:"signup"}}},[t._v("SignUp")])],1),r("b-button",{attrs:{id:"submit",type:"submit",variant:"primary"}},[t._v("SignIn")])],1)],1)],1)},N=[],J={name:"SignIn",data:function(){return{email:"",password:""}},computed:{isError:function(){return"error"===this.$store.getters.authStatus},isUserCreated:function(){return"create"===this.$store.getters.userEvent}},methods:{signIn:function(){var t=this,e=this.email,r=this.password;this.$store.dispatch("authRequest",{email:e,password:r}).then((function(){t.$router.push("/posts/own"),t.$store.dispatch("getUser")}))}}},F=J,G=Object(R["a"])(F,D,N,!1,null,null,null),K=G.exports,Q=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container text-center bv-example-row bv-example-row-flex-cols"},[r("b-row",{staticClass:"mt-5",attrs:{"align-h":"center"}},[r("b-form",{staticClass:"form",on:{submit:function(e){return e.preventDefault(),t.signUp(e)}}},[r("h3",[t._v("SignUp")]),r("b-form-group",{staticClass:"text-left",attrs:{label:"Email","label-for":"email"}},[r("b-form-input",{attrs:{id:"email",type:"email",required:""},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),t.emailErrors?r("b-list-group",t._l(t.emailErrors,(function(e){return r("b-list-group-item",{key:e.id,attrs:{variant:"danger"}},[t._v(" "+t._s(e)+" ")])})),1):t._e()],1),r("b-form-group",{staticClass:"text-left",attrs:{label:"Password","label-for":"password"}},[r("b-form-input",{attrs:{id:"password",type:"password",required:""},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),t.passwordErrors?r("b-list-group",t._l(t.passwordErrors,(function(e){return r("b-list-group-item",{key:e.id,attrs:{variant:"danger"}},[t._v(" "+t._s(e)+" ")])})),1):t._e()],1),r("b-form-group",{staticClass:"text-left",attrs:{label:"Confirm Password","label-for":"password_repeat"}},[r("b-form-input",{attrs:{id:"password_repeat",type:"password",required:""},model:{value:t.password_repeat,callback:function(e){t.password_repeat=e},expression:"password_repeat"}}),t.arePasswordsEqual()?t._e():r("p",{staticClass:"alert alert-danger"},[t._v("Passwords must be the same")])],1),r("p",[t._v("Have an account? "),r("b-link",{attrs:{to:{name:"signin"}}},[t._v("SignIn")])],1),r("b-button",{attrs:{id:"submit",type:"submit",variant:"primary"}},[t._v("SignUp")])],1)],1)],1)},V=[],W={name:"SignUp",data:function(){return{email:"",password:"",password_repeat:"",emailErrors:"",passwordErrors:""}},methods:{signUp:function(){var t=this,e={email:this.email,password:this.password,password_repeat:this.password_repeat};this.$store.dispatch("createUser",e).then((function(){Ct.push("/signin")}),(function(e){t.emailErrors=e.response.data.email,t.passwordErrors=e.response.data.password}))},arePasswordsEqual:function(){return this.password_repeat===this.password}}},X=W,Y=Object(R["a"])(X,Q,V,!1,null,null,null),Z=Y.exports,tt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container"},[r("h3",[t._v("All Posts")]),r("postList",{attrs:{posts:t.posts}})],1)},et=[],rt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container"},[r("b-row",[r("b-col",{attrs:{cols:"10"}},[r("b-row",[r("b-table",{attrs:{items:t.posts,fields:t.fields,responsive:"","primary-key":"id"},scopedSlots:t._u([{key:"cell(title)",fn:function(e){return[r("p",[r("b-link",{attrs:{to:{name:"retrieve-post",params:{id:e.item.id}}}},[t._v(t._s(e.item.title))])],1)]}},{key:"cell(owner)",fn:function(e){return[r("p",[t._v(t._s(e.item.owner.email))])]}}])})],1)],1)],1)],1)},st=[],nt={name:"postList",props:["posts"],data:function(){return{fields:["title","created","modified","owner","users_liked_count"]}}},ot=nt,at=Object(R["a"])(ot,rt,st,!1,null,null,null),it=at.exports,ut={name:"allPostsList",components:{postList:it},computed:{posts:function(){return this.$store.getters.posts}},beforeMount:function(){this.$store.dispatch("getPosts",{params:{owner:"false"}})}},ct=ut,lt=Object(R["a"])(ct,tt,et,!1,null,null,null),pt=lt.exports,dt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"container"},[r("h3",[t._v("Own Posts")]),r("b-button",{attrs:{id:"create",to:{name:"create-post"},variant:"info"}},[t._v("Create Post")]),r("b-alert",{attrs:{variant:"success",show:t.isPostCreated,dismissible:""}},[t._v("New post was created successfully.")]),r("postList",{attrs:{posts:t.posts}})],1)},ft=[],mt={name:"ownPostsList",components:{postList:it},computed:{posts:function(){return this.$store.getters.posts},isPostCreated:function(){return"create"===this.$store.getters.postEvent}},beforeMount:function(){this.$store.dispatch("getPosts",{params:{owner:"true"}})}},ht=mt,bt=Object(R["a"])(ht,dt,ft,!1,null,null,null),vt=bt.exports,gt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t.eventError?r("b-alert",{attrs:{variant:"danger",dismissible:""},model:{value:t.eventError,callback:function(e){t.eventError=e},expression:"eventError"}},[t._v(t._s(t.eventError))]):t._e(),r("b-form",{on:{submit:t.onSubmit}},[r("b-form-group",{attrs:{label:"Title","label-for":"title"}},[r("b-form-input",{attrs:{id:"title",type:"text",required:""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),r("b-form-group",{attrs:{label:"Body","label-for":"body"}},[r("b-form-textarea",{attrs:{id:"body",rows:"3","max-rows":"6",required:""},model:{value:t.form.body,callback:function(e){t.$set(t.form,"body",e)},expression:"form.body"}})],1),r("b-button",{attrs:{id:"submit",type:"submit",variant:"primary"}},[t._v("Submit")])],1)],1)},wt=[],_t={name:"postForm",data:function(){return{form:{title:null,body:null},eventError:""}},methods:{onSubmit:function(t){var e=this;t.preventDefault();var r={title:this.form.title,body:this.form.body};this.$store.dispatch("createPost",r).then((function(){Ct.push("/posts/own")}),(function(t){e.eventError=t.response.data}))}}},kt=_t,Et=Object(R["a"])(kt,gt,wt,!1,null,null,null),yt=Et.exports,St=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("b-card",{attrs:{title:t.post.title}},[r("b-card-text",[t._v(" "+t._s(t.post.body)+" ")]),r("h6",[t._v("Likes "),r("b-badge",[t._v(t._s(t.likes))])],1),r("h6",[t._v("Author "),r("b-badge",[t._v(t._s(t.post.owner.email))])],1),r("h6",[t._v("Created "),r("b-badge",[t._v(t._s(t.post.created))])],1),r("h6",[t._v("Modified "),r("b-badge",[t._v(t._s(t.post.modified))])],1),t.isOwner?t._e():[t.liked?t.liked?r("b-button",{attrs:{id:"unlike",variant:"primary"},on:{click:function(e){return t.changePostLikes("unlike")}}},[t._v("UnLike")]):t._e():r("b-button",{attrs:{id:"like",variant:"primary"},on:{click:function(e){return t.changePostLikes("like")}}},[t._v("Like")])]],2)},xt=[],Ot=(r("4160"),r("caad"),r("2532"),r("159b"),{name:"postRetrieve",computed:{post:function(){return this.$store.getters.post},likes:function(){return this.$store.getters.post.users_liked.length},authUser:function(){return this.$store.getters.authUser[0]},isOwner:function(){return this.$store.getters.post.owner.id===this.authUser.id},users_liked_ids:function(){var t=[];return this.$store.getters.post.users_liked.forEach((function(e){t.push(e.id)})),t},liked:function(){return this.users_liked_ids.includes(this.authUser.id)}},methods:{changePostLikes:function(t){var e={post:{id:this.post.id,owner:this.post.owner,users_liked:this.post.users_liked},data:{action:t}};this.$store.dispatch("likePost",e)}},beforeMount:function(){this.$store.dispatch("getPost",this.$route.params.id),this.$store.dispatch("getUser")}}),Pt=Ot,jt=Object(R["a"])(Pt,St,xt,!1,null,null,null),$t=jt.exports;n["default"].use(z["a"]);var Ut=function(t,e,r){$.getters.isAuthenticated?r("/posts/own"):r()},Tt=function(t,e,r){$.getters.isAuthenticated?r():r("/signin")},Ct=new z["a"]({mode:"history",routes:[{path:"/",redirect:"/posts/own"},{path:"/signup",name:"signup",component:Z},{path:"/signin",name:"signin",component:K,beforeEnter:Ut},{path:"/posts/own",name:"own-posts",component:vt,beforeEnter:Tt},{path:"/posts/all",name:"all-posts",component:pt,beforeEnter:Tt},{path:"/post/create",name:"create-post",component:yt,beforeEnter:Tt},{path:"/post/:id",name:"retrieve-post",component:$t,beforeEnter:Tt}]}),At=r("5f5b");r("f9e3"),r("2dd8");n["default"].config.productionTip=!1,n["default"].use(o["a"]),n["default"].use(At["a"]);var Rt=localStorage.getItem("user-token");Rt&&(x.defaults.headers.common.Authorization="Bearer ".concat(Rt)),new n["default"]({router:Ct,store:$,render:function(t){return t(H)}}).$mount("#app")}});
//# sourceMappingURL=app.e2479c82.js.map